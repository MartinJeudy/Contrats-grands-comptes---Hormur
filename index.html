<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hormur Sales ‚Äî Prospection Grands Comptes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300..700;1,9..40,300..700&family=Fraunces:ital,opsz,wght@0,9..144,300..900;1,9..144,300..900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwindcss.config = {
      theme: {
        extend: {
          fontFamily: {
            'display': ['Fraunces', 'serif'],
            'sans': ['DM Sans', 'system-ui', 'sans-serif'],
          },
          colors: {
            'hormur': {
              'cream': '#FDF8F3',
              'sand': '#E8DDD4',
              'terracotta': '#C4704B',
              'rust': '#A85632',
              'deep': '#2D2926',
              'forest': '#2C4A3E',
              'sage': '#8B9D83',
              'gold': '#D4A853',
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out',
            'slide-up': 'slideUp 0.4s ease-out',
            'pulse-soft': 'pulseSoft 2s ease-in-out infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            pulseSoft: {
              '0%, 100%': { opacity: '1' },
              '50%': { opacity: '0.7' },
            }
          }
        }
      }
    }
  </script>
  <style>
    * {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    body {
      background: linear-gradient(135deg, #FDF8F3 0%, #E8DDD4 100%);
      min-height: 100vh;
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.8);
    }
    
    .status-badge {
      font-size: 0.65rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      font-weight: 600;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #C4704B 0%, #A85632 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 40px rgba(196, 112, 75, 0.3);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #2C4A3E 0%, #1a2d26 100%);
    }
    
    .input-field {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(45, 41, 38, 0.1);
      transition: all 0.3s ease;
    }
    
    .input-field:focus {
      border-color: #C4704B;
      box-shadow: 0 0 0 3px rgba(196, 112, 75, 0.1);
    }
    
    .lead-card {
      transition: all 0.3s ease;
    }
    
    .lead-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 60px rgba(45, 41, 38, 0.15);
    }
    
    .nav-item {
      position: relative;
    }
    
    .nav-item.active::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 24px;
      height: 3px;
      background: #C4704B;
      border-radius: 2px;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(232, 221, 212, 0.5);
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(196, 112, 75, 0.4);
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(196, 112, 75, 0.6);
    }
    
    /* Mobile optimizations */
    @media (max-width: 768px) {
      .mobile-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 50;
      }
    }
    
    .pipeline-stage {
      min-width: 280px;
    }
    
    @media (max-width: 768px) {
      .pipeline-stage {
        min-width: 100%;
      }
    }
    
    .message-template {
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .message-template:hover {
      background: rgba(196, 112, 75, 0.1);
    }
    
    .toast {
      animation: slideUp 0.4s ease-out;
    }
    
    /* Grain texture overlay */
    .grain-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0.03;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E");
      z-index: 9999;
    }
  </style>
</head>
<body class="font-sans text-hormur-deep">
  <div class="grain-overlay"></div>
  <div id="root"></div>
  
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect, useCallback, createContext, useContext, useMemo } = React;
    
    // ============================================
    // CONFIGURATION & CONSTANTS
    // ============================================
    
    const CONFIG = {
      N8N_WEBHOOK_BASE: 'https://votre-instance-n8n.com/webhook/', // √Ä configurer
      ADMIN_EMAIL: 'martin@hormur.com',
      APP_VERSION: '1.0.0',
    };
    
    const STATUSES = {
      TO_CONTACT: { label: '√Ä contacter', color: 'bg-gray-400', order: 0 },
      INVITE_SENT: { label: 'Invitation envoy√©e', color: 'bg-blue-400', order: 1 },
      CONNECTED: { label: 'Connect√©', color: 'bg-cyan-400', order: 2 },
      MSG_1_SENT: { label: 'Message envoy√©', color: 'bg-indigo-400', order: 3 },
      RELANCE_1_SENT: { label: 'Relance 1', color: 'bg-violet-400', order: 4 },
      RELANCE_2_SENT: { label: 'Relance 2', color: 'bg-purple-400', order: 5 },
      REPLIED: { label: 'üî• R√©ponse re√ßue', color: 'bg-hormur-gold', order: 6 },
      ASSIGNED: { label: 'Pris en charge', color: 'bg-hormur-terracotta', order: 7 },
      EN_NEGO: { label: 'En n√©gociation', color: 'bg-hormur-sage', order: 8 },
      RDV_PRIS: { label: 'RDV planifi√©', color: 'bg-hormur-forest', order: 9 },
      CONTRAT_EN_COURS: { label: 'Contrat en cours', color: 'bg-emerald-500', order: 10 },
      SIGNE: { label: 'üéâ Sign√© !', color: 'bg-green-500', order: 11 },
      PERDU: { label: 'Perdu', color: 'bg-red-400', order: 12 },
      WITHDRAWN: { label: 'Retir√©', color: 'bg-gray-500', order: 13 },
      CLOSED: { label: 'Ferm√©', color: 'bg-gray-600', order: 14 },
    };
    
    const COMMERCIAL_PIPELINE = ['REPLIED', 'ASSIGNED', 'EN_NEGO', 'RDV_PRIS', 'CONTRAT_EN_COURS', 'SIGNE', 'PERDU'];
    
    const MESSAGE_TEMPLATES = [
      {
        id: 1,
        title: "Proposition de RDV",
        category: "rdv",
        content: "Bonjour {first_name},\n\nMerci pour votre retour ! Je serais ravi d'√©changer plus en d√©tail sur vos besoins.\n\nVoici mon lien pour r√©server un cr√©neau : {calendly_link}\n\n√Ä tr√®s vite,\nMartin Jeudy\nCEO Hormur"
      },
      {
        id: 2,
        title: "R√©ponse : pas le budget maintenant",
        category: "relance",
        content: "Bonjour {first_name},\n\nJe comprends tout √† fait. Je me permets de noter votre int√©r√™t et reviendrai vers vous dans quelques mois.\n\nD'ici l√†, n'h√©sitez pas si votre situation √©volue.\n\nBien cordialement,\nMartin Jeudy"
      },
      {
        id: 3,
        title: "R√©ponse : demande d'informations",
        category: "info",
        content: "Bonjour {first_name},\n\nAvec plaisir ! Hormur permet aux entreprises comme {company} d'offrir des exp√©riences artistiques uniques √† leurs √©quipes : concerts intimistes, ateliers cr√©atifs, performances...\n\nNous avons accompagn√© des groupes comme LVMH, Accor ou encore des collectivit√©s.\n\nJe vous propose un √©change de 15 minutes pour vous pr√©senter des exemples concrets : {calendly_link}\n\nMartin Jeudy"
      },
      {
        id: 4,
        title: "R√©ponse : pas int√©ress√©",
        category: "cloture",
        content: "Bonjour {first_name},\n\nJe vous remercie pour votre retour. Je comprends que ce n'est pas d'actualit√© pour {company}.\n\nJe reste disponible si vos besoins √©voluent.\n\nBonne continuation,\nMartin Jeudy"
      },
      {
        id: 5,
        title: "Relance apr√®s RDV",
        category: "suivi",
        content: "Bonjour {first_name},\n\nSuite √† notre √©change, je voulais m'assurer que vous aviez bien re√ßu les √©l√©ments √©voqu√©s.\n\nAvez-vous pu en discuter en interne ? Je reste disponible pour toute question.\n\nBien cordialement,\nMartin Jeudy"
      },
      {
        id: 6,
        title: "Envoi de proposition commerciale",
        category: "contrat",
        content: "Bonjour {first_name},\n\nComme convenu, vous trouverez ci-joint notre proposition pour {company}.\n\nJe me tiens √† votre disposition pour en discuter et ajuster si n√©cessaire.\n\nBien cordialement,\nMartin Jeudy"
      }
    ];
    
    // ============================================
    // CONTEXT & STATE MANAGEMENT
    // ============================================
    
    const AppContext = createContext(null);
    
    const useApp = () => {
      const context = useContext(AppContext);
      if (!context) throw new Error('useApp must be used within AppProvider');
      return context;
    };
    
    // ============================================
    // STORAGE HELPERS (localStorage for demo)
    // ============================================
    
    const storage = {
      get: (key) => {
        try {
          const item = localStorage.getItem(`hormur_${key}`);
          return item ? JSON.parse(item) : null;
        } catch {
          return null;
        }
      },
      set: (key, value) => {
        try {
          localStorage.setItem(`hormur_${key}`, JSON.stringify(value));
          return true;
        } catch {
          return false;
        }
      },
      remove: (key) => {
        localStorage.removeItem(`hormur_${key}`);
      }
    };
    
    // ============================================
    // ICON COMPONENTS
    // ============================================
    
    const Icon = ({ name, size = 20, className = '' }) => {
      const ref = React.useRef(null);
      
      useEffect(() => {
        if (ref.current && lucide[name]) {
          ref.current.innerHTML = '';
          const svg = lucide.createElement(lucide[name]);
          svg.setAttribute('width', size);
          svg.setAttribute('height', size);
          if (className) {
            className.split(' ').forEach(c => svg.classList.add(c));
          }
          ref.current.appendChild(svg);
        }
      }, [name, size, className]);
      
      return <span ref={ref} className="inline-flex items-center justify-center" />;
    };
    
    // ============================================
    // UTILITY COMPONENTS
    // ============================================
    
    const Toast = ({ message, type = 'success', onClose }) => {
      useEffect(() => {
        const timer = setTimeout(onClose, 4000);
        return () => clearTimeout(timer);
      }, [onClose]);
      
      const bgColor = type === 'success' ? 'bg-hormur-forest' : type === 'error' ? 'bg-red-500' : 'bg-hormur-terracotta';
      
      return (
        <div className={`toast fixed bottom-24 md:bottom-8 left-1/2 -translate-x-1/2 ${bgColor} text-white px-6 py-3 rounded-full shadow-2xl z-50 flex items-center gap-3`}>
          <Icon name={type === 'success' ? 'CheckCircle' : type === 'error' ? 'XCircle' : 'Info'} size={18} />
          <span className="font-medium">{message}</span>
        </div>
      );
    };
    
    const Modal = ({ isOpen, onClose, title, children, size = 'md' }) => {
      if (!isOpen) return null;
      
      const sizeClasses = {
        sm: 'max-w-md',
        md: 'max-w-lg',
        lg: 'max-w-2xl',
        xl: 'max-w-4xl',
        full: 'max-w-6xl'
      };
      
      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          <div className="absolute inset-0 bg-hormur-deep/60 backdrop-blur-sm" onClick={onClose} />
          <div className={`glass-card relative w-full ${sizeClasses[size]} rounded-2xl shadow-2xl animate-slide-up max-h-[90vh] overflow-hidden flex flex-col`}>
            <div className="flex items-center justify-between p-6 border-b border-hormur-sand/50">
              <h2 className="font-display text-xl font-semibold text-hormur-deep">{title}</h2>
              <button onClick={onClose} className="p-2 hover:bg-hormur-sand/50 rounded-full transition-colors">
                <Icon name="X" size={20} />
              </button>
            </div>
            <div className="p-6 overflow-y-auto flex-1">
              {children}
            </div>
          </div>
        </div>
      );
    };
    
    const StatusBadge = ({ status }) => {
      const config = STATUSES[status] || { label: status, color: 'bg-gray-400' };
      return (
        <span className={`status-badge ${config.color} text-white px-2.5 py-1 rounded-full`}>
          {config.label}
        </span>
      );
    };
    
    // ============================================
    // LOGIN PAGE
    // ============================================
    
    const LoginPage = ({ onLogin }) => {
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      
      const handleSubmit = async (e) => {
        e.preventDefault();
        setError('');
        setIsLoading(true);
        
        // Simulate API call
        await new Promise(r => setTimeout(r, 800));
        
        // Check credentials
        const users = storage.get('users') || [];
        const adminExists = users.some(u => u.email === CONFIG.ADMIN_EMAIL);
        
        // Auto-create admin if not exists
        if (!adminExists) {
          users.push({
            id: 'admin-1',
            email: CONFIG.ADMIN_EMAIL,
            password: 'hormur2024',
            name: 'Martin Jeudy',
            role: 'admin',
            calendlyLink: 'https://calendly.com/martin-hormur',
            createdAt: new Date().toISOString()
          });
          storage.set('users', users);
        }
        
        const user = users.find(u => u.email === email.toLowerCase());
        
        if (!user) {
          setError('Compte non trouv√©. Contactez l\'administrateur.');
          setIsLoading(false);
          return;
        }
        
        if (user.password !== password) {
          setError('Mot de passe incorrect');
          setIsLoading(false);
          return;
        }
        
        if (!user.active && user.role !== 'admin') {
          setError('Votre compte a √©t√© d√©sactiv√©');
          setIsLoading(false);
          return;
        }
        
        storage.set('currentUser', user);
        onLogin(user);
      };
      
      return (
        <div className="min-h-screen flex items-center justify-center p-4">
          <div className="glass-card rounded-3xl p-8 md:p-12 w-full max-w-md animate-fade-in">
            <div className="text-center mb-8">
              <div className="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-hormur-terracotta to-hormur-rust rounded-2xl mb-4 shadow-lg">
                <Icon name="Sparkles" size={32} className="text-white" />
              </div>
              <h1 className="font-display text-3xl font-bold text-hormur-deep mb-2">Hormur Sales</h1>
              <p className="text-hormur-deep/60">Prospection Grands Comptes</p>
            </div>
            
            <form onSubmit={handleSubmit} className="space-y-5">
              {error && (
                <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm">
                  {error}
                </div>
              )}
              
              <div>
                <label className="block text-sm font-medium text-hormur-deep/70 mb-2">Email</label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  className="input-field w-full px-4 py-3 rounded-xl outline-none"
                  placeholder="votre@email.com"
                  required
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-hormur-deep/70 mb-2">Mot de passe</label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="input-field w-full px-4 py-3 rounded-xl outline-none"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  required
                />
              </div>
              
              <button
                type="submit"
                disabled={isLoading}
                className="btn-primary w-full py-4 rounded-xl text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {isLoading ? (
                  <span className="flex items-center justify-center gap-2">
                    <Icon name="Loader2" size={20} className="animate-spin" />
                    Connexion...
                  </span>
                ) : 'Se connecter'}
              </button>
            </form>
            
            <div className="mt-8 pt-6 border-t border-hormur-sand/50 text-center">
              <p className="text-xs text-hormur-deep/40">
                Admin : martin@hormur.com / hormur2024
              </p>
            </div>
          </div>
        </div>
      );
    };
    
    // ============================================
    // NAVIGATION
    // ============================================
    
    const Navigation = ({ currentView, setCurrentView, user, onLogout }) => {
      const navItems = [
        { id: 'dashboard', icon: 'LayoutDashboard', label: 'Dashboard' },
        { id: 'pipeline', icon: 'Kanban', label: 'Pipeline' },
        { id: 'prospects', icon: 'Users', label: 'Prospects' },
        { id: 'leaderboard', icon: 'Trophy', label: 'Classement' },
      ];
      
      if (user.role === 'admin') {
        navItems.push({ id: 'admin', icon: 'Settings', label: 'Admin' });
      }
      
      return (
        <>
          {/* Desktop Navigation */}
          <nav className="hidden md:block glass-card fixed top-4 left-4 right-4 z-40 rounded-2xl shadow-xl">
            <div className="flex items-center justify-between px-6 py-4">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-gradient-to-br from-hormur-terracotta to-hormur-rust rounded-xl flex items-center justify-center">
                  <Icon name="Sparkles" size={20} className="text-white" />
                </div>
                <span className="font-display text-xl font-bold">Hormur Sales</span>
              </div>
              
              <div className="flex items-center gap-1">
                {navItems.map(item => (
                  <button
                    key={item.id}
                    onClick={() => setCurrentView(item.id)}
                    className={`nav-item flex items-center gap-2 px-4 py-2 rounded-xl transition-colors ${
                      currentView === item.id 
                        ? 'text-hormur-terracotta font-semibold' 
                        : 'text-hormur-deep/60 hover:text-hormur-deep hover:bg-hormur-sand/30'
                    }`}
                  >
                    <Icon name={item.icon} size={18} />
                    <span>{item.label}</span>
                  </button>
                ))}
              </div>
              
              <div className="flex items-center gap-4">
                <div className="text-right">
                  <p className="text-sm font-medium text-hormur-deep">{user.name}</p>
                  <p className="text-xs text-hormur-deep/50">{user.role === 'admin' ? 'Administrateur' : 'Commercial'}</p>
                </div>
                <button
                  onClick={onLogout}
                  className="p-2 hover:bg-hormur-sand/50 rounded-xl transition-colors"
                  title="D√©connexion"
                >
                  <Icon name="LogOut" size={20} className="text-hormur-deep/60" />
                </button>
              </div>
            </div>
          </nav>
          
          {/* Mobile Navigation */}
          <nav className="md:hidden mobile-nav glass-card shadow-2xl border-t border-hormur-sand/50">
            <div className="flex items-center justify-around py-2 px-2">
              {navItems.map(item => (
                <button
                  key={item.id}
                  onClick={() => setCurrentView(item.id)}
                  className={`flex flex-col items-center gap-1 px-3 py-2 rounded-xl transition-colors ${
                    currentView === item.id 
                      ? 'text-hormur-terracotta' 
                      : 'text-hormur-deep/50'
                  }`}
                >
                  <Icon name={item.icon} size={22} />
                  <span className="text-[10px] font-medium">{item.label}</span>
                </button>
              ))}
              <button
                onClick={onLogout}
                className="flex flex-col items-center gap-1 px-3 py-2 text-hormur-deep/50"
              >
                <Icon name="LogOut" size={22} />
                <span className="text-[10px] font-medium">Sortir</span>
              </button>
            </div>
          </nav>
          
          {/* Mobile Header */}
          <header className="md:hidden glass-card fixed top-0 left-0 right-0 z-40 px-4 py-3 flex items-center justify-between">
            <div className="flex items-center gap-2">
              <div className="w-8 h-8 bg-gradient-to-br from-hormur-terracotta to-hormur-rust rounded-lg flex items-center justify-center">
                <Icon name="Sparkles" size={16} className="text-white" />
              </div>
              <span className="font-display text-lg font-bold">Hormur Sales</span>
            </div>
            <div className="text-right">
              <p className="text-sm font-medium text-hormur-deep">{user.name.split(' ')[0]}</p>
            </div>
          </header>
        </>
      );
    };
    
    // ============================================
    // DASHBOARD VIEW
    // ============================================
    
    const DashboardView = ({ prospects, user, onClaimLead, onUpdateStatus, setCurrentView }) => {
      const stats = useMemo(() => {
        const myProspects = prospects.filter(p => p.assignedTo === user.email);
        return {
          newReplies: prospects.filter(p => p.status === 'REPLIED').length,
          myActive: myProspects.filter(p => ['ASSIGNED', 'EN_NEGO', 'RDV_PRIS', 'CONTRAT_EN_COURS'].includes(p.status)).length,
          myRdv: myProspects.filter(p => p.status === 'RDV_PRIS').length,
          mySigned: myProspects.filter(p => p.status === 'SIGNE').length,
        };
      }, [prospects, user.email]);
      
      const hotLeads = prospects.filter(p => p.status === 'REPLIED').slice(0, 5);
      const myRecentActivity = prospects
        .filter(p => p.assignedTo === user.email)
        .sort((a, b) => new Date(b.lastUpdate || 0) - new Date(a.lastUpdate || 0))
        .slice(0, 5);
      
      return (
        <div className="animate-fade-in space-y-6">
          {/* Stats Grid */}
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <div className="glass-card rounded-2xl p-5">
              <div className="flex items-center gap-3 mb-3">
                <div className="w-10 h-10 bg-hormur-gold/20 rounded-xl flex items-center justify-center">
                  <Icon name="Flame" size={20} className="text-hormur-gold" />
                </div>
                <span className="text-sm text-hormur-deep/60">Nouvelles r√©ponses</span>
              </div>
              <p className="text-3xl font-display font-bold text-hormur-deep">{stats.newReplies}</p>
            </div>
            
            <div className="glass-card rounded-2xl p-5">
              <div className="flex items-center gap-3 mb-3">
                <div className="w-10 h-10 bg-hormur-terracotta/20 rounded-xl flex items-center justify-center">
                  <Icon name="MessageSquare" size={20} className="text-hormur-terracotta" />
                </div>
                <span className="text-sm text-hormur-deep/60">Mes n√©gos actives</span>
              </div>
              <p className="text-3xl font-display font-bold text-hormur-deep">{stats.myActive}</p>
            </div>
            
            <div className="glass-card rounded-2xl p-5">
              <div className="flex items-center gap-3 mb-3">
                <div className="w-10 h-10 bg-hormur-forest/20 rounded-xl flex items-center justify-center">
                  <Icon name="Calendar" size={20} className="text-hormur-forest" />
                </div>
                <span className="text-sm text-hormur-deep/60">RDV planifi√©s</span>
              </div>
              <p className="text-3xl font-display font-bold text-hormur-deep">{stats.myRdv}</p>
            </div>
            
            <div className="glass-card rounded-2xl p-5">
              <div className="flex items-center gap-3 mb-3">
                <div className="w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center">
                  <Icon name="Trophy" size={20} className="text-green-500" />
                </div>
                <span className="text-sm text-hormur-deep/60">Contrats sign√©s</span>
              </div>
              <p className="text-3xl font-display font-bold text-hormur-deep">{stats.mySigned}</p>
            </div>
          </div>
          
          <div className="grid lg:grid-cols-2 gap-6">
            {/* Hot Leads */}
            <div className="glass-card rounded-2xl p-6">
              <div className="flex items-center justify-between mb-5">
                <h2 className="font-display text-xl font-semibold flex items-center gap-2">
                  <Icon name="Flame" size={22} className="text-hormur-gold" />
                  Leads chauds √† traiter
                </h2>
                <button 
                  onClick={() => setCurrentView('pipeline')}
                  className="text-sm text-hormur-terracotta font-medium hover:underline"
                >
                  Voir tout ‚Üí
                </button>
              </div>
              
              {hotLeads.length === 0 ? (
                <div className="text-center py-8 text-hormur-deep/50">
                  <Icon name="Inbox" size={40} className="mx-auto mb-3 opacity-50" />
                  <p>Aucun nouveau lead en attente</p>
                </div>
              ) : (
                <div className="space-y-3">
                  {hotLeads.map(lead => (
                    <div key={lead.id} className="flex items-center justify-between p-4 bg-hormur-cream/50 rounded-xl">
                      <div className="flex-1 min-w-0">
                        <p className="font-medium text-hormur-deep truncate">
                          {lead.firstName} {lead.lastName}
                        </p>
                        <p className="text-sm text-hormur-deep/60 truncate">{lead.company}</p>
                      </div>
                      <button
                        onClick={() => onClaimLead(lead.id)}
                        className="btn-primary px-4 py-2 rounded-lg text-white text-sm font-medium flex items-center gap-2"
                      >
                        <Icon name="UserPlus" size={16} />
                        Prendre
                      </button>
                    </div>
                  ))}
                </div>
              )}
            </div>
            
            {/* My Activity */}
            <div className="glass-card rounded-2xl p-6">
              <h2 className="font-display text-xl font-semibold mb-5 flex items-center gap-2">
                <Icon name="Activity" size={22} className="text-hormur-terracotta" />
                Mon activit√© r√©cente
              </h2>
              
              {myRecentActivity.length === 0 ? (
                <div className="text-center py-8 text-hormur-deep/50">
                  <Icon name="Clock" size={40} className="mx-auto mb-3 opacity-50" />
                  <p>Aucune activit√© r√©cente</p>
                </div>
              ) : (
                <div className="space-y-3">
                  {myRecentActivity.map(lead => (
                    <div key={lead.id} className="flex items-center justify-between p-4 bg-hormur-cream/50 rounded-xl">
                      <div className="flex-1 min-w-0">
                        <p className="font-medium text-hormur-deep truncate">
                          {lead.firstName} {lead.lastName}
                        </p>
                        <p className="text-sm text-hormur-deep/60 truncate">{lead.company}</p>
                      </div>
                      <StatusBadge status={lead.status} />
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
          
          {/* Quick Actions */}
          <div className="glass-card rounded-2xl p-6">
            <h2 className="font-display text-xl font-semibold mb-5">Actions rapides</h2>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <button 
                onClick={() => setCurrentView('pipeline')}
                className="p-4 bg-hormur-cream/50 hover:bg-hormur-sand/50 rounded-xl transition-colors text-left"
              >
                <Icon name="Kanban" size={24} className="text-hormur-terracotta mb-2" />
                <p className="font-medium text-sm">Voir mon pipeline</p>
              </button>
              <button 
                onClick={() => setCurrentView('prospects')}
                className="p-4 bg-hormur-cream/50 hover:bg-hormur-sand/50 rounded-xl transition-colors text-left"
              >
                <Icon name="Upload" size={24} className="text-hormur-forest mb-2" />
                <p className="font-medium text-sm">Importer des prospects</p>
              </button>
              <button 
                onClick={() => window.open(user.calendlyLink || 'https://calendly.com', '_blank')}
                className="p-4 bg-hormur-cream/50 hover:bg-hormur-sand/50 rounded-xl transition-colors text-left"
              >
                <Icon name="ExternalLink" size={24} className="text-hormur-sage mb-2" />
                <p className="font-medium text-sm">Mon Calendly</p>
              </button>
              <button 
                onClick={() => setCurrentView('leaderboard')}
                className="p-4 bg-hormur-cream/50 hover:bg-hormur-sand/50 rounded-xl transition-colors text-left"
              >
                <Icon name="Trophy" size={24} className="text-hormur-gold mb-2" />
                <p className="font-medium text-sm">Classement</p>
              </button>
            </div>
          </div>
        </div>
      );
    };
    
    // ============================================
    // PIPELINE VIEW
    // ============================================
    
    const PipelineView = ({ prospects, user, users, onClaimLead, onUpdateStatus, onOpenDetail }) => {
      const [selectedTemplate, setSelectedTemplate] = useState(null);
      const [detailLead, setDetailLead] = useState(null);
      
      const pipelineData = useMemo(() => {
        const stages = {};
        COMMERCIAL_PIPELINE.forEach(status => {
          stages[status] = prospects.filter(p => {
            if (status === 'REPLIED') {
              return p.status === 'REPLIED';
            }
            return p.status === status && p.assignedTo === user.email;
          });
        });
        return stages;
      }, [prospects, user.email]);
      
      const handleDrop = (leadId, newStatus) => {
        onUpdateStatus(leadId, newStatus);
      };
      
      return (
        <div className="animate-fade-in">
          <div className="flex items-center justify-between mb-6">
            <h1 className="font-display text-2xl font-bold">Mon Pipeline</h1>
            <div className="text-sm text-hormur-deep/60">
              {Object.values(pipelineData).flat().length} prospects actifs
            </div>
          </div>
          
          {/* Pipeline Board */}
          <div className="flex gap-4 overflow-x-auto pb-4 -mx-4 px-4 md:mx-0 md:px-0">
            {COMMERCIAL_PIPELINE.map(status => (
              <div 
                key={status}
                className="pipeline-stage flex-shrink-0"
              >
                <div className="glass-card rounded-2xl p-4 min-h-[400px]">
                  <div className="flex items-center gap-2 mb-4">
                    <StatusBadge status={status} />
                    <span className="text-sm text-hormur-deep/50">
                      ({pipelineData[status]?.length || 0})
                    </span>
                  </div>
                  
                  <div className="space-y-3">
                    {pipelineData[status]?.map(lead => (
                      <div
                        key={lead.id}
                        onClick={() => setDetailLead(lead)}
                        className="lead-card bg-white/80 rounded-xl p-4 cursor-pointer"
                      >
                        <div className="flex items-start justify-between mb-2">
                          <div>
                            <p className="font-medium text-hormur-deep">
                              {lead.firstName} {lead.lastName}
                            </p>
                            <p className="text-sm text-hormur-deep/60">{lead.company}</p>
                          </div>
                          {lead.assignedTo && lead.assignedTo !== user.email && (
                            <span className="text-xs bg-hormur-sand/50 px-2 py-1 rounded-full">
                              {users.find(u => u.email === lead.assignedTo)?.name?.split(' ')[0] || 'Autre'}
                            </span>
                          )}
                        </div>
                        
                        {status === 'REPLIED' && !lead.assignedTo && (
                          <button
                            onClick={(e) => {
                              e.stopPropagation();
                              onClaimLead(lead.id);
                            }}
                            className="w-full mt-2 btn-primary py-2 rounded-lg text-white text-sm font-medium"
                          >
                            Prendre ce lead
                          </button>
                        )}
                        
                        {lead.assignedTo === user.email && status !== 'SIGNE' && status !== 'PERDU' && (
                          <div className="mt-3 pt-3 border-t border-hormur-sand/30 flex gap-2">
                            {status !== 'PERDU' && (
                              <button
                                onClick={(e) => {
                                  e.stopPropagation();
                                  const nextIdx = COMMERCIAL_PIPELINE.indexOf(status) + 1;
                                  if (nextIdx < COMMERCIAL_PIPELINE.length - 1) {
                                    onUpdateStatus(lead.id, COMMERCIAL_PIPELINE[nextIdx]);
                                  }
                                }}
                                className="flex-1 bg-hormur-forest/10 hover:bg-hormur-forest/20 text-hormur-forest px-3 py-1.5 rounded-lg text-xs font-medium transition-colors"
                              >
                                Avancer ‚Üí
                              </button>
                            )}
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                onUpdateStatus(lead.id, 'PERDU');
                              }}
                              className="bg-red-50 hover:bg-red-100 text-red-600 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors"
                            >
                              Perdu
                            </button>
                          </div>
                        )}
                      </div>
                    ))}
                    
                    {pipelineData[status]?.length === 0 && (
                      <div className="text-center py-8 text-hormur-deep/30">
                        <Icon name="Inbox" size={32} className="mx-auto mb-2 opacity-50" />
                        <p className="text-sm">Aucun prospect</p>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            ))}
          </div>
          
          {/* Lead Detail Modal */}
          <Modal
            isOpen={!!detailLead}
            onClose={() => setDetailLead(null)}
            title={detailLead ? `${detailLead.firstName} ${detailLead.lastName}` : ''}
            size="lg"
          >
            {detailLead && (
              <LeadDetailPanel 
                lead={detailLead} 
                user={user}
                users={users}
                onClaimLead={onClaimLead}
                onUpdateStatus={onUpdateStatus}
                onClose={() => setDetailLead(null)}
              />
            )}
          </Modal>
        </div>
      );
    };
    
    // ============================================
    // LEAD DETAIL PANEL
    // ============================================
    
    const LeadDetailPanel = ({ lead, user, users, onClaimLead, onUpdateStatus, onClose }) => {
      const [activeTab, setActiveTab] = useState('info');
      const [messageContent, setMessageContent] = useState('');
      const [notes, setNotes] = useState(lead.notes || '');
      const { showToast } = useApp();
      
      const applyTemplate = (template) => {
        let content = template.content
          .replace('{first_name}', lead.firstName || '')
          .replace('{company}', lead.company || '')
          .replace('{calendly_link}', user.calendlyLink || 'https://calendly.com/votre-lien');
        setMessageContent(content);
      };
      
      const copyToClipboard = (text) => {
        navigator.clipboard.writeText(text);
        showToast('Copi√© dans le presse-papier !');
      };
      
      const saveNotes = () => {
        // In real app, this would update the lead
        const prospects = storage.get('prospects') || [];
        const idx = prospects.findIndex(p => p.id === lead.id);
        if (idx >= 0) {
          prospects[idx].notes = notes;
          storage.set('prospects', prospects);
          showToast('Notes sauvegard√©es');
        }
      };
      
      return (
        <div className="space-y-6">
          {/* Header Info */}
          <div className="flex items-start justify-between">
            <div>
              <p className="text-lg font-semibold text-hormur-deep">{lead.company}</p>
              <div className="flex items-center gap-3 mt-2">
                <StatusBadge status={lead.status} />
                {lead.assignedTo && (
                  <span className="text-sm text-hormur-deep/60">
                    Assign√© √† : {users.find(u => u.email === lead.assignedTo)?.name || lead.assignedTo}
                  </span>
                )}
              </div>
            </div>
            <a
              href={lead.linkedinUrl}
              target="_blank"
              rel="noopener noreferrer"
              className="flex items-center gap-2 text-sm text-hormur-terracotta hover:underline"
            >
              <Icon name="Linkedin" size={16} />
              Voir LinkedIn
            </a>
          </div>
          
          {/* Tabs */}
          <div className="flex gap-1 border-b border-hormur-sand/50">
            {[
              { id: 'info', label: 'Informations', icon: 'User' },
              { id: 'messages', label: 'Messages', icon: 'MessageSquare' },
              { id: 'notes', label: 'Notes', icon: 'FileText' },
            ].map(tab => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors border-b-2 -mb-px ${
                  activeTab === tab.id
                    ? 'border-hormur-terracotta text-hormur-terracotta'
                    : 'border-transparent text-hormur-deep/60 hover:text-hormur-deep'
                }`}
              >
                <Icon name={tab.icon} size={16} />
                {tab.label}
              </button>
            ))}
          </div>
          
          {/* Tab Content */}
          {activeTab === 'info' && (
            <div className="space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-hormur-cream/50 rounded-xl p-4">
                  <p className="text-xs text-hormur-deep/50 mb-1">Pr√©nom</p>
                  <p className="font-medium">{lead.firstName || '-'}</p>
                </div>
                <div className="bg-hormur-cream/50 rounded-xl p-4">
                  <p className="text-xs text-hormur-deep/50 mb-1">Nom</p>
                  <p className="font-medium">{lead.lastName || '-'}</p>
                </div>
                <div className="bg-hormur-cream/50 rounded-xl p-4 col-span-2">
                  <p className="text-xs text-hormur-deep/50 mb-1">Entreprise</p>
                  <p className="font-medium">{lead.company}</p>
                </div>
                <div className="bg-hormur-cream/50 rounded-xl p-4 col-span-2">
                  <p className="text-xs text-hormur-deep/50 mb-1">URL LinkedIn</p>
                  <p className="font-medium text-sm break-all">{lead.linkedinUrl}</p>
                </div>
              </div>
              
              {/* Status Actions */}
              {lead.status === 'REPLIED' && !lead.assignedTo && (
                <button
                  onClick={() => {
                    onClaimLead(lead.id);
                    onClose();
                  }}
                  className="w-full btn-primary py-3 rounded-xl text-white font-semibold"
                >
                  Prendre ce lead
                </button>
              )}
              
              {lead.assignedTo === user.email && lead.status !== 'SIGNE' && lead.status !== 'PERDU' && (
                <div className="space-y-3">
                  <p className="text-sm font-medium text-hormur-deep/70">Changer le statut :</p>
                  <div className="flex flex-wrap gap-2">
                    {COMMERCIAL_PIPELINE.slice(1).map(status => (
                      <button
                        key={status}
                        onClick={() => onUpdateStatus(lead.id, status)}
                        disabled={status === lead.status}
                        className={`px-3 py-2 rounded-lg text-xs font-medium transition-colors ${
                          status === lead.status
                            ? 'bg-hormur-terracotta text-white'
                            : 'bg-hormur-cream/50 hover:bg-hormur-sand/50 text-hormur-deep/70'
                        }`}
                      >
                        {STATUSES[status]?.label || status}
                      </button>
                    ))}
                  </div>
                </div>
              )}
            </div>
          )}
          
          {activeTab === 'messages' && (
            <div className="space-y-4">
              <div>
                <p className="text-sm font-medium text-hormur-deep/70 mb-3">Templates de messages</p>
                <div className="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto">
                  {MESSAGE_TEMPLATES.map(template => (
                    <button
                      key={template.id}
                      onClick={() => applyTemplate(template)}
                      className="message-template p-3 bg-hormur-cream/50 rounded-xl text-left"
                    >
                      <p className="text-sm font-medium text-hormur-deep">{template.title}</p>
                      <p className="text-xs text-hormur-deep/50 mt-1">{template.category}</p>
                    </button>
                  ))}
                </div>
              </div>
              
              <div>
                <div className="flex items-center justify-between mb-2">
                  <p className="text-sm font-medium text-hormur-deep/70">Message √† envoyer</p>
                  <button
                    onClick={() => copyToClipboard(messageContent)}
                    disabled={!messageContent}
                    className="text-sm text-hormur-terracotta hover:underline disabled:opacity-50"
                  >
                    Copier
                  </button>
                </div>
                <textarea
                  value={messageContent}
                  onChange={(e) => setMessageContent(e.target.value)}
                  placeholder="S√©lectionnez un template ou r√©digez votre message..."
                  className="input-field w-full px-4 py-3 rounded-xl outline-none h-48 resize-none"
                />
              </div>
              
              <div className="flex gap-3">
                <button
                  onClick={() => copyToClipboard(messageContent)}
                  disabled={!messageContent}
                  className="flex-1 btn-primary py-3 rounded-xl text-white font-medium disabled:opacity-50"
                >
                  <span className="flex items-center justify-center gap-2">
                    <Icon name="Copy" size={18} />
                    Copier le message
                  </span>
                </button>
                <a
                  href={lead.linkedinUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex-1 btn-secondary py-3 rounded-xl text-white font-medium text-center"
                >
                  <span className="flex items-center justify-center gap-2">
                    <Icon name="ExternalLink" size={18} />
                    Ouvrir LinkedIn
                  </span>
                </a>
              </div>
            </div>
          )}
          
          {activeTab === 'notes' && (
            <div className="space-y-4">
              <textarea
                value={notes}
                onChange={(e) => setNotes(e.target.value)}
                placeholder="Ajoutez vos notes sur ce prospect..."
                className="input-field w-full px-4 py-3 rounded-xl outline-none h-48 resize-none"
              />
              <button
                onClick={saveNotes}
                className="w-full btn-primary py-3 rounded-xl text-white font-medium"
              >
                Sauvegarder les notes
              </button>
            </div>
          )}
        </div>
      );
    };
    
    // ============================================
    // PROSPECTS VIEW
    // ============================================
    
    const ProspectsView = ({ prospects, user, onImportCSV }) => {
      const [search, setSearch] = useState('');
      const [filterStatus, setFilterStatus] = useState('all');
      const [showImportModal, setShowImportModal] = useState(false);
      
      const filteredProspects = useMemo(() => {
        return prospects.filter(p => {
          const matchesSearch = !search || 
            `${p.firstName} ${p.lastName} ${p.company}`.toLowerCase().includes(search.toLowerCase());
          const matchesStatus = filterStatus === 'all' || p.status === filterStatus;
          return matchesSearch && matchesStatus;
        });
      }, [prospects, search, filterStatus]);
      
      return (
        <div className="animate-fade-in">
          <div className="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
            <h1 className="font-display text-2xl font-bold">Base de prospects</h1>
            <button
              onClick={() => setShowImportModal(true)}
              className="btn-primary px-5 py-2.5 rounded-xl text-white font-medium flex items-center gap-2"
            >
              <Icon name="Upload" size={18} />
              Importer CSV
            </button>
          </div>
          
          {/* Filters */}
          <div className="glass-card rounded-2xl p-4 mb-6 flex flex-col md:flex-row gap-4">
            <div className="flex-1">
              <div className="relative">
                <Icon name="Search" size={18} className="absolute left-3 top-1/2 -translate-y-1/2 text-hormur-deep/40" />
                <input
                  type="text"
                  value={search}
                  onChange={(e) => setSearch(e.target.value)}
                  placeholder="Rechercher par nom ou entreprise..."
                  className="input-field w-full pl-10 pr-4 py-2.5 rounded-xl outline-none"
                />
              </div>
            </div>
            <select
              value={filterStatus}
              onChange={(e) => setFilterStatus(e.target.value)}
              className="input-field px-4 py-2.5 rounded-xl outline-none"
            >
              <option value="all">Tous les statuts</option>
              {Object.entries(STATUSES).map(([key, val]) => (
                <option key={key} value={key}>{val.label}</option>
              ))}
            </select>
          </div>
          
          {/* Table */}
          <div className="glass-card rounded-2xl overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-hormur-sand/30">
                  <tr>
                    <th className="px-4 py-3 text-left text-xs font-semibold text-hormur-deep/70 uppercase tracking-wider">Nom</th>
                    <th className="px-4 py-3 text-left text-xs font-semibold text-hormur-deep/70 uppercase tracking-wider">Entreprise</th>
                    <th className="px-4 py-3 text-left text-xs font-semibold text-hormur-deep/70 uppercase tracking-wider">Statut</th>
                    <th className="px-4 py-3 text-left text-xs font-semibold text-hormur-deep/70 uppercase tracking-wider">Assign√© √†</th>
                    <th className="px-4 py-3 text-left text-xs font-semibold text-hormur-deep/70 uppercase tracking-wider">LinkedIn</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-hormur-sand/30">
                  {filteredProspects.map(prospect => (
                    <tr key={prospect.id} className="hover:bg-hormur-cream/30 transition-colors">
                      <td className="px-4 py-3">
                        <p className="font-medium text-hormur-deep">{prospect.firstName} {prospect.lastName}</p>
                      </td>
                      <td className="px-4 py-3 text-hormur-deep/70">{prospect.company}</td>
                      <td className="px-4 py-3">
                        <StatusBadge status={prospect.status} />
                      </td>
                      <td className="px-4 py-3 text-sm text-hormur-deep/60">
                        {prospect.assignedTo || '-'}
                      </td>
                      <td className="px-4 py-3">
                        <a
                          href={prospect.linkedinUrl}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="text-hormur-terracotta hover:underline text-sm"
                        >
                          Voir profil
                        </a>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            
            {filteredProspects.length === 0 && (
              <div className="text-center py-12 text-hormur-deep/50">
                <Icon name="Users" size={40} className="mx-auto mb-3 opacity-50" />
                <p>Aucun prospect trouv√©</p>
              </div>
            )}
          </div>
          
          {/* Import Modal */}
          <Modal
            isOpen={showImportModal}
            onClose={() => setShowImportModal(false)}
            title="Importer des prospects"
            size="md"
          >
            <ImportCSVForm onImport={(data) => {
              onImportCSV(data);
              setShowImportModal(false);
            }} />
          </Modal>
        </div>
      );
    };
    
    // ============================================
    // IMPORT CSV FORM
    // ============================================
    
    const ImportCSVForm = ({ onImport }) => {
      const [csvContent, setCsvContent] = useState('');
      const [preview, setPreview] = useState([]);
      const [error, setError] = useState('');
      const { showToast } = useApp();
      
      const parseCSV = (content) => {
        const lines = content.trim().split('\n');
        if (lines.length < 2) {
          setError('Le fichier doit contenir au moins un en-t√™te et une ligne de donn√©es');
          return [];
        }
        
        const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
        const requiredHeaders = ['linkedin_url', 'company'];
        
        for (const req of requiredHeaders) {
          if (!headers.includes(req)) {
            setError(`Colonne requise manquante : ${req}`);
            return [];
          }
        }
        
        const data = [];
        for (let i = 1; i < lines.length; i++) {
          const values = lines[i].split(',').map(v => v.trim());
          const row = {};
          headers.forEach((h, idx) => {
            row[h] = values[idx] || '';
          });
          
          // Validate LinkedIn URL
          if (row.linkedin_url && row.linkedin_url.includes('linkedin.com')) {
            data.push({
              id: `import-${Date.now()}-${i}`,
              linkedinUrl: row.linkedin_url,
              company: row.company,
              firstName: row.first_name || '',
              lastName: row.last_name || '',
              status: 'TO_CONTACT',
              lastUpdate: new Date().toISOString()
            });
          }
        }
        
        setError('');
        return data;
      };
      
      const handleFileUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const content = e.target.result;
            setCsvContent(content);
            const parsed = parseCSV(content);
            setPreview(parsed.slice(0, 5));
          };
          reader.readAsText(file);
        }
      };
      
      const handleImport = () => {
        const data = parseCSV(csvContent);
        if (data.length > 0) {
          onImport(data);
          showToast(`${data.length} prospects import√©s avec succ√®s !`);
        }
      };
      
      return (
        <div className="space-y-5">
          <div>
            <p className="text-sm text-hormur-deep/70 mb-3">
              Format attendu : CSV avec les colonnes <code className="bg-hormur-cream px-1.5 py-0.5 rounded">linkedin_url</code> et <code className="bg-hormur-cream px-1.5 py-0.5 rounded">company</code> (obligatoires)
            </p>
            <p className="text-xs text-hormur-deep/50">
              Colonnes optionnelles : first_name, last_name
            </p>
          </div>
          
          <div className="border-2 border-dashed border-hormur-sand rounded-xl p-6 text-center">
            <input
              type="file"
              accept=".csv"
              onChange={handleFileUpload}
              className="hidden"
              id="csv-upload"
            />
            <label htmlFor="csv-upload" className="cursor-pointer">
              <Icon name="Upload" size={32} className="mx-auto mb-3 text-hormur-terracotta" />
              <p className="font-medium text-hormur-deep">Cliquez pour s√©lectionner un fichier CSV</p>
              <p className="text-sm text-hormur-deep/50 mt-1">ou glissez-d√©posez ici</p>
            </label>
          </div>
          
          {error && (
            <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm">
              {error}
            </div>
          )}
          
          {preview.length > 0 && (
            <div>
              <p className="text-sm font-medium text-hormur-deep/70 mb-2">
                Aper√ßu ({preview.length} premiers) :
              </p>
              <div className="bg-hormur-cream/50 rounded-xl p-3 max-h-40 overflow-y-auto">
                {preview.map((p, i) => (
                  <div key={i} className="text-sm text-hormur-deep py-1">
                    {p.firstName} {p.lastName} ‚Äî {p.company}
                  </div>
                ))}
              </div>
            </div>
          )}
          
          <button
            onClick={handleImport}
            disabled={preview.length === 0}
            className="w-full btn-primary py-3 rounded-xl text-white font-semibold disabled:opacity-50"
          >
            Importer {preview.length > 0 ? `(${parseCSV(csvContent).length} prospects)` : ''}
          </button>
        </div>
      );
    };
    
    // ============================================
    // LEADERBOARD VIEW
    // ============================================
    
    const LeaderboardView = ({ prospects, users }) => {
      const leaderboard = useMemo(() => {
        const stats = {};
        
        users.filter(u => u.role !== 'admin').forEach(user => {
          stats[user.email] = {
            name: user.name,
            email: user.email,
            signed: 0,
            inProgress: 0,
            rdv: 0,
            total: 0,
            points: 0
          };
        });
        
        // Include admin in leaderboard too
        const admin = users.find(u => u.role === 'admin');
        if (admin) {
          stats[admin.email] = {
            name: admin.name,
            email: admin.email,
            signed: 0,
            inProgress: 0,
            rdv: 0,
            total: 0,
            points: 0
          };
        }
        
        prospects.forEach(p => {
          if (p.assignedTo && stats[p.assignedTo]) {
            stats[p.assignedTo].total++;
            if (p.status === 'SIGNE') {
              stats[p.assignedTo].signed++;
              stats[p.assignedTo].points += 100;
            } else if (p.status === 'CONTRAT_EN_COURS') {
              stats[p.assignedTo].inProgress++;
              stats[p.assignedTo].points += 50;
            } else if (p.status === 'RDV_PRIS') {
              stats[p.assignedTo].rdv++;
              stats[p.assignedTo].points += 25;
            } else if (['ASSIGNED', 'EN_NEGO'].includes(p.status)) {
              stats[p.assignedTo].points += 10;
            }
          }
        });
        
        return Object.values(stats).sort((a, b) => b.points - a.points);
      }, [prospects, users]);
      
      const medals = ['ü•á', 'ü•à', 'ü•â'];
      
      return (
        <div className="animate-fade-in">
          <h1 className="font-display text-2xl font-bold mb-6">Classement des commerciaux</h1>
          
          {/* Podium */}
          <div className="glass-card rounded-2xl p-6 mb-6">
            <div className="flex items-end justify-center gap-4 h-48">
              {leaderboard.slice(0, 3).map((user, idx) => (
                <div 
                  key={user.email}
                  className={`flex flex-col items-center ${
                    idx === 0 ? 'order-2' : idx === 1 ? 'order-1' : 'order-3'
                  }`}
                >
                  <span className="text-3xl mb-2">{medals[idx]}</span>
                  <div 
                    className={`w-20 md:w-28 ${
                      idx === 0 ? 'h-32 bg-hormur-gold' : 
                      idx === 1 ? 'h-24 bg-gray-300' : 
                      'h-16 bg-hormur-terracotta/70'
                    } rounded-t-xl flex items-center justify-center`}
                  >
                    <span className="text-white font-display text-2xl font-bold">{user.points}</span>
                  </div>
                  <p className="mt-2 text-sm font-medium text-center">{user.name.split(' ')[0]}</p>
                </div>
              ))}
            </div>
          </div>
          
          {/* Stats Table */}
          <div className="glass-card rounded-2xl overflow-hidden">
            <table className="w-full">
              <thead className="bg-hormur-sand/30">
                <tr>
                  <th className="px-4 py-3 text-left text-xs font-semibold text-hormur-deep/70 uppercase">#</th>
                  <th className="px-4 py-3 text-left text-xs font-semibold text-hormur-deep/70 uppercase">Commercial</th>
                  <th className="px-4 py-3 text-center text-xs font-semibold text-hormur-deep/70 uppercase">RDV</th>
                  <th className="px-4 py-3 text-center text-xs font-semibold text-hormur-deep/70 uppercase">En cours</th>
                  <th className="px-4 py-3 text-center text-xs font-semibold text-hormur-deep/70 uppercase">Sign√©s</th>
                  <th className="px-4 py-3 text-center text-xs font-semibold text-hormur-deep/70 uppercase">Points</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-hormur-sand/30">
                {leaderboard.map((user, idx) => (
                  <tr key={user.email} className="hover:bg-hormur-cream/30">
                    <td className="px-4 py-3 font-medium">{idx + 1}</td>
                    <td className="px-4 py-3">
                      <p className="font-medium">{user.name}</p>
                    </td>
                    <td className="px-4 py-3 text-center">{user.rdv}</td>
                    <td className="px-4 py-3 text-center">{user.inProgress}</td>
                    <td className="px-4 py-3 text-center font-semibold text-green-600">{user.signed}</td>
                    <td className="px-4 py-3 text-center">
                      <span className="bg-hormur-gold/20 text-hormur-deep px-3 py-1 rounded-full font-semibold">
                        {user.points}
                      </span>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          
          {/* Points Legend */}
          <div className="mt-6 glass-card rounded-2xl p-5">
            <h3 className="font-semibold mb-3">Syst√®me de points</h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
              <div className="bg-hormur-cream/50 rounded-xl p-3">
                <p className="font-semibold text-hormur-gold">+100 pts</p>
                <p className="text-hormur-deep/60">Contrat sign√©</p>
              </div>
              <div className="bg-hormur-cream/50 rounded-xl p-3">
                <p className="font-semibold text-emerald-600">+50 pts</p>
                <p className="text-hormur-deep/60">Contrat en cours</p>
              </div>
              <div className="bg-hormur-cream/50 rounded-xl p-3">
                <p className="font-semibold text-hormur-forest">+25 pts</p>
                <p className="text-hormur-deep/60">RDV planifi√©</p>
              </div>
              <div className="bg-hormur-cream/50 rounded-xl p-3">
                <p className="font-semibold text-hormur-terracotta">+10 pts</p>
                <p className="text-hormur-deep/60">N√©go en cours</p>
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    // ============================================
    // ADMIN VIEW
    // ============================================
    
    const AdminView = ({ users, prospects, onAddUser, onToggleUserStatus, onDeleteUser }) => {
      const [showAddUser, setShowAddUser] = useState(false);
      const [newUser, setNewUser] = useState({ name: '', email: '', password: '', calendlyLink: '' });
      const { showToast } = useApp();
      
      const handleAddUser = () => {
        if (!newUser.name || !newUser.email || !newUser.password) {
          showToast('Veuillez remplir tous les champs obligatoires', 'error');
          return;
        }
        
        onAddUser({
          ...newUser,
          id: `user-${Date.now()}`,
          role: 'commercial',
          active: true,
          createdAt: new Date().toISOString()
        });
        
        setNewUser({ name: '', email: '', password: '', calendlyLink: '' });
        setShowAddUser(false);
        showToast('Commercial ajout√© avec succ√®s !');
      };
      
      const commercials = users.filter(u => u.role !== 'admin');
      
      return (
        <div className="animate-fade-in">
          <div className="flex items-center justify-between mb-6">
            <h1 className="font-display text-2xl font-bold">Administration</h1>
          </div>
          
          {/* Stats Overview */}
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div className="glass-card rounded-2xl p-5">
              <p className="text-sm text-hormur-deep/60 mb-1">Commerciaux actifs</p>
              <p className="text-2xl font-display font-bold">{commercials.filter(u => u.active !== false).length}</p>
            </div>
            <div className="glass-card rounded-2xl p-5">
              <p className="text-sm text-hormur-deep/60 mb-1">Total prospects</p>
              <p className="text-2xl font-display font-bold">{prospects.length}</p>
            </div>
            <div className="glass-card rounded-2xl p-5">
              <p className="text-sm text-hormur-deep/60 mb-1">En n√©gociation</p>
              <p className="text-2xl font-display font-bold">
                {prospects.filter(p => ['EN_NEGO', 'RDV_PRIS', 'CONTRAT_EN_COURS'].includes(p.status)).length}
              </p>
            </div>
            <div className="glass-card rounded-2xl p-5">
              <p className="text-sm text-hormur-deep/60 mb-1">Sign√©s</p>
              <p className="text-2xl font-display font-bold text-green-600">
                {prospects.filter(p => p.status === 'SIGNE').length}
              </p>
            </div>
          </div>
          
          {/* Users Management */}
          <div className="glass-card rounded-2xl p-6">
            <div className="flex items-center justify-between mb-5">
              <h2 className="font-display text-xl font-semibold">Gestion des commerciaux</h2>
              <button
                onClick={() => setShowAddUser(true)}
                className="btn-primary px-4 py-2 rounded-xl text-white font-medium flex items-center gap-2"
              >
                <Icon name="UserPlus" size={18} />
                Ajouter
              </button>
            </div>
            
            <div className="space-y-3">
              {commercials.map(user => (
                <div 
                  key={user.id}
                  className="flex items-center justify-between p-4 bg-hormur-cream/50 rounded-xl"
                >
                  <div className="flex-1">
                    <div className="flex items-center gap-3">
                      <p className="font-medium">{user.name}</p>
                      {user.active === false && (
                        <span className="text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded-full">Inactif</span>
                      )}
                    </div>
                    <p className="text-sm text-hormur-deep/60">{user.email}</p>
                  </div>
                  <div className="flex items-center gap-2">
                    <button
                      onClick={() => onToggleUserStatus(user.id)}
                      className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${
                        user.active !== false
                          ? 'bg-red-50 hover:bg-red-100 text-red-600'
                          : 'bg-green-50 hover:bg-green-100 text-green-600'
                      }`}
                    >
                      {user.active !== false ? 'D√©sactiver' : 'R√©activer'}
                    </button>
                    <button
                      onClick={() => {
                        if (confirm(`Supprimer ${user.name} ?`)) {
                          onDeleteUser(user.id);
                        }
                      }}
                      className="p-2 hover:bg-red-50 rounded-lg text-red-500 transition-colors"
                    >
                      <Icon name="Trash2" size={18} />
                    </button>
                  </div>
                </div>
              ))}
              
              {commercials.length === 0 && (
                <div className="text-center py-8 text-hormur-deep/50">
                  <Icon name="Users" size={40} className="mx-auto mb-3 opacity-50" />
                  <p>Aucun commercial enregistr√©</p>
                </div>
              )}
            </div>
          </div>
          
          {/* Webhooks Config */}
          <div className="glass-card rounded-2xl p-6 mt-6">
            <h2 className="font-display text-xl font-semibold mb-5">Configuration n8n</h2>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-hormur-deep/70 mb-2">
                  Webhook pour recevoir les mises √† jour
                </label>
                <code className="block bg-hormur-cream/50 p-3 rounded-xl text-sm break-all">
                  {window.location.origin}/api/webhook/n8n-sync
                </code>
              </div>
              <div>
                <label className="block text-sm font-medium text-hormur-deep/70 mb-2">
                  DataTable ID (n8n)
                </label>
                <code className="block bg-hormur-cream/50 p-3 rounded-xl text-sm">
                  qEIH9PLD15HVf0KT
                </code>
              </div>
            </div>
          </div>
          
          {/* Add User Modal */}
          <Modal
            isOpen={showAddUser}
            onClose={() => setShowAddUser(false)}
            title="Ajouter un commercial"
            size="sm"
          >
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-hormur-deep/70 mb-2">Nom complet *</label>
                <input
                  type="text"
                  value={newUser.name}
                  onChange={(e) => setNewUser({ ...newUser, name: e.target.value })}
                  className="input-field w-full px-4 py-3 rounded-xl outline-none"
                  placeholder="Jean Dupont"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-hormur-deep/70 mb-2">Email *</label>
                <input
                  type="email"
                  value={newUser.email}
                  onChange={(e) => setNewUser({ ...newUser, email: e.target.value.toLowerCase() })}
                  className="input-field w-full px-4 py-3 rounded-xl outline-none"
                  placeholder="jean@email.com"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-hormur-deep/70 mb-2">Mot de passe *</label>
                <input
                  type="text"
                  value={newUser.password}
                  onChange={(e) => setNewUser({ ...newUser, password: e.target.value })}
                  className="input-field w-full px-4 py-3 rounded-xl outline-none"
                  placeholder="motdepasse123"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-hormur-deep/70 mb-2">Lien Calendly</label>
                <input
                  type="url"
                  value={newUser.calendlyLink}
                  onChange={(e) => setNewUser({ ...newUser, calendlyLink: e.target.value })}
                  className="input-field w-full px-4 py-3 rounded-xl outline-none"
                  placeholder="https://calendly.com/..."
                />
              </div>
              <button
                onClick={handleAddUser}
                className="w-full btn-primary py-3 rounded-xl text-white font-semibold"
              >
                Cr√©er le compte
              </button>
            </div>
          </Modal>
        </div>
      );
    };
    
    // ============================================
    // MAIN APP
    // ============================================
    
    const App = () => {
      const [user, setUser] = useState(null);
      const [currentView, setCurrentView] = useState('dashboard');
      const [prospects, setProspects] = useState([]);
      const [users, setUsers] = useState([]);
      const [toast, setToast] = useState(null);
      const [isLoading, setIsLoading] = useState(true);
      
      // Load initial data
      useEffect(() => {
        const savedUser = storage.get('currentUser');
        const savedProspects = storage.get('prospects') || [];
        const savedUsers = storage.get('users') || [];
        
        if (savedUser) {
          setUser(savedUser);
        }
        setProspects(savedProspects);
        setUsers(savedUsers);
        setIsLoading(false);
      }, []);
      
      // Save prospects when changed
      useEffect(() => {
        if (prospects.length > 0) {
          storage.set('prospects', prospects);
        }
      }, [prospects]);
      
      // Save users when changed
      useEffect(() => {
        if (users.length > 0) {
          storage.set('users', users);
        }
      }, [users]);
      
      const showToast = useCallback((message, type = 'success') => {
        setToast({ message, type });
      }, []);
      
      const handleLogin = (userData) => {
        setUser(userData);
      };
      
      const handleLogout = () => {
        storage.remove('currentUser');
        setUser(null);
        setCurrentView('dashboard');
      };
      
      const handleClaimLead = (leadId) => {
        setProspects(prev => prev.map(p => 
          p.id === leadId 
            ? { ...p, status: 'ASSIGNED', assignedTo: user.email, lastUpdate: new Date().toISOString() }
            : p
        ));
        showToast('Lead assign√© avec succ√®s !');
      };
      
      const handleUpdateStatus = (leadId, newStatus) => {
        setProspects(prev => prev.map(p => 
          p.id === leadId 
            ? { ...p, status: newStatus, lastUpdate: new Date().toISOString() }
            : p
        ));
        showToast(`Statut mis √† jour : ${STATUSES[newStatus]?.label || newStatus}`);
      };
      
      const handleImportCSV = (data) => {
        setProspects(prev => [...prev, ...data]);
      };
      
      const handleAddUser = (userData) => {
        setUsers(prev => [...prev, userData]);
      };
      
      const handleToggleUserStatus = (userId) => {
        setUsers(prev => prev.map(u => 
          u.id === userId ? { ...u, active: u.active === false ? true : false } : u
        ));
      };
      
      const handleDeleteUser = (userId) => {
        setUsers(prev => prev.filter(u => u.id !== userId));
        showToast('Utilisateur supprim√©');
      };
      
      const contextValue = {
        user,
        users,
        prospects,
        showToast,
      };
      
      if (isLoading) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="text-center">
              <Icon name="Loader2" size={40} className="animate-spin text-hormur-terracotta mx-auto mb-4" />
              <p className="text-hormur-deep/60">Chargement...</p>
            </div>
          </div>
        );
      }
      
      if (!user) {
        return <LoginPage onLogin={handleLogin} />;
      }
      
      return (
        <AppContext.Provider value={contextValue}>
          <div className="min-h-screen pb-24 md:pb-8">
            <Navigation 
              currentView={currentView}
              setCurrentView={setCurrentView}
              user={user}
              onLogout={handleLogout}
            />
            
            <main className="pt-20 md:pt-28 px-4 md:px-8 max-w-7xl mx-auto">
              {currentView === 'dashboard' && (
                <DashboardView 
                  prospects={prospects}
                  user={user}
                  onClaimLead={handleClaimLead}
                  onUpdateStatus={handleUpdateStatus}
                  setCurrentView={setCurrentView}
                />
              )}
              
              {currentView === 'pipeline' && (
                <PipelineView 
                  prospects={prospects}
                  user={user}
                  users={users}
                  onClaimLead={handleClaimLead}
                  onUpdateStatus={handleUpdateStatus}
                />
              )}
              
              {currentView === 'prospects' && (
                <ProspectsView 
                  prospects={prospects}
                  user={user}
                  onImportCSV={handleImportCSV}
                />
              )}
              
              {currentView === 'leaderboard' && (
                <LeaderboardView 
                  prospects={prospects}
                  users={users}
                />
              )}
              
              {currentView === 'admin' && user.role === 'admin' && (
                <AdminView 
                  users={users}
                  prospects={prospects}
                  onAddUser={handleAddUser}
                  onToggleUserStatus={handleToggleUserStatus}
                  onDeleteUser={handleDeleteUser}
                />
              )}
            </main>
            
            {toast && (
              <Toast 
                message={toast.message} 
                type={toast.type}
                onClose={() => setToast(null)} 
              />
            )}
          </div>
        </AppContext.Provider>
      );
    };
    
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
